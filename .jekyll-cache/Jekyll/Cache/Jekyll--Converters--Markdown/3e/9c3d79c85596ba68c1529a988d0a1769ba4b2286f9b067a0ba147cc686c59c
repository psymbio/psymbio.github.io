I"¡¿<h2 id="the-problem-were-dealing-with">The Problem Weâ€™re Dealing With</h2>

<p>Develop a social network website with thousands of users. With the use of data structure to efficiently represent and store the usersâ€™ profiles. Keep the information about how these users are connected with each other.</p>

<p>Find out the friends for a given user. This search needs to be executed quickly as there are thousands of users.</p>

<p>Find the common friends for two given users. Propose a suitable data structure; implement the insert, delete, search operations and relevant algorithms to solve the problem. Analyse the time and space complexities of all the operations.</p>

<h2 id="my-solution">My Solution</h2>

<p>For the entire program visit: <a href="https://github.com/psymbio/social-network-graph">https://github.com/psymbio/social-network-graph</a></p>

<p>Initially, I thought of constructing two 2D matrices, one which would hold the information of all the users and the other that holds the data of how these people are connected with each other.</p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>username</th>
      <th style="text-align: left">password</th>
      <th>name</th>
      <th>email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>cornetto_tornado</td>
      <td style="text-align: left">severussnaps</td>
      <td>Rick Roll</td>
      <td>cornetto@yahoo.co.uk</td>
    </tr>
    <tr>
      <td>2</td>
      <td>xX-witchyPrincess-Xx</td>
      <td style="text-align: left">hhsj112@</td>
      <td>Chandler Bing</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>3</td>
      <td>dancingsloths</td>
      <td style="text-align: left">nothing</td>
      <td>Julian Assange</td>
      <td>mumbo@jumbo.com</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>

<p>But with thousands of users, the CSV file of the connections crashed my text-editor. Not only that, but if there was a 25% chance someone was your friend then about 50% of the space used by the graph goes to waste, which is a great deal if youâ€™re handling thousands of users.</p>

<p>Then I decided to make an adjacency-list representation of a graph. This would only deal with the ids of each user in the graph to show the connection, saving space.</p>

<p><img src="https://www.d.umn.edu/~gshute/cs2511/slides/graphs/images/adj-list-1.png" alt="Adjacency Graph" /></p>

<p>Now to create the graph:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// structure to represent an user node</span>
<span class="k">struct</span> <span class="n">user_node</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">dest</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// structure to represent the list of users</span>
<span class="k">struct</span> <span class="n">user_list</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">head</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// graph is an array of adjacency lists.</span>
<span class="k">struct</span> <span class="n">Graph</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">V</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">user_list</span> <span class="o">*</span><span class="n">array</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// A utility function to create a new adjacency list node</span>
<span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="nf">newuser_node</span><span class="p">(</span><span class="kt">int</span> <span class="n">dest</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">newNode</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">user_node</span><span class="p">));</span>
    <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
    <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">newNode</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// create a graph of V vertices</span>
<span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="nf">createGraph</span><span class="p">(</span><span class="kt">int</span> <span class="n">V</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span><span class="p">));</span>
    <span class="n">graph</span><span class="o">-&gt;</span><span class="n">V</span> <span class="o">=</span> <span class="n">V</span><span class="p">;</span>
    <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">user_list</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">V</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">user_list</span><span class="p">));</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">V</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">head</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">graph</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Now that our graph has been implemented, letâ€™s carry out some functionality of the program.</p>

<h5 id="1-add-a-friend">1. Add a Friend</h5>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// add an edge to an undirected graph</span>
<span class="kt">void</span> <span class="nf">add_friend</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">,</span> <span class="kt">int</span> <span class="n">src</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dest</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// add edge from src to dest</span>
    <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">newNode</span> <span class="o">=</span> <span class="n">newuser_node</span><span class="p">(</span><span class="n">dest</span><span class="p">);</span>
    <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">src</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
    <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">src</span><span class="p">].</span><span class="n">head</span> <span class="o">=</span> <span class="n">newNode</span><span class="p">;</span>
    <span class="c1">// add edge from dest to src</span>
    <span class="n">newNode</span> <span class="o">=</span> <span class="n">newuser_node</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
    <span class="n">newNode</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">dest</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
    <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">dest</span><span class="p">].</span><span class="n">head</span> <span class="o">=</span> <span class="n">newNode</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>This simply adds an edge between two user nodes of the graph and takes linear time O(1).</p>

<h5 id="2-find-a-node">2. Find a Node</h5>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="nf">find_user</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">,</span> <span class="kt">int</span> <span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">V</span><span class="p">;</span> <span class="o">++</span><span class="n">v</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">pCrawl</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">pCrawl</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">dest</span> <span class="o">==</span> <span class="n">src</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">pCrawl</span> <span class="o">=</span> <span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This takes O(n^2) time complexity to find a user_node.</p>

<h5 id="3-remove-a-friend">3. Remove a Friend</h5>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">remove_friend</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">find_user</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">find_user</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">dest</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">aCrawl</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">bCrawl</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">aCrawl</span> <span class="o">||</span> <span class="n">bCrawl</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">aCrawl</span><span class="o">-&gt;</span><span class="n">dest</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">free</span><span class="p">(</span><span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">);</span>
            <span class="n">aCrawl</span> <span class="o">=</span> <span class="n">aCrawl</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">bCrawl</span><span class="o">-&gt;</span><span class="n">dest</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>
                <span class="n">free</span><span class="p">(</span><span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">);</span>
            <span class="n">bCrawl</span> <span class="o">=</span> <span class="n">bCrawl</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This takes O(n) time complexity.</p>

<h5 id="4-delete-your-account">4. Delete Your Account</h5>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">delete_user</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">find_user</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">V</span><span class="p">;</span> <span class="o">++</span><span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">aCrawl</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">free</span><span class="p">(</span><span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">delete_your_account</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">,</span> <span class="n">MYSQL</span> <span class="o">*</span><span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">delete_user</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">atoi</span><span class="p">(</span><span class="n">current_uid</span><span class="p">));</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">,</span> <span class="s">"DELETE FROM user_database where id=%d"</span><span class="p">,</span> <span class="n">atoi</span><span class="p">(</span><span class="n">current_uid</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mysql_query</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">sql_statement</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">finish_with_error</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">So long, and thanks for all the fish.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Deleting your account deletes the array of friends you had and your information in the database. Since find_user takes O(n^2) so does this.</p>

<h5 id="5-print-entire-graph">5. Print Entire Graph</h5>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">print_friend_graph</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">V</span><span class="p">;</span> <span class="o">++</span><span class="n">v</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">pCrawl</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Friends of %d are:</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">pCrawl</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"-&gt; %d"</span><span class="p">,</span> <span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">dest</span><span class="p">);</span>
            <span class="n">pCrawl</span> <span class="o">=</span> <span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This prints the entire graph in O(n^2) however this is only a back-end function that normal users cannot run.</p>

<h5 id="6-print-the-friends-of-a-user">6. Print the Friends of a User</h5>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">print_userid_friends</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">MYSQL</span> <span class="o">*</span><span class="n">conn</span><span class="p">,</span> <span class="n">MYSQL_ROW</span> <span class="n">row</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">pCrawl</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">pCrawl</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">,</span> <span class="s">"SELECT username, first_name, last_name </span><span class="err">
</span><span class="s">        FROM user_database WHERE id=%d"</span><span class="p">,</span> <span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">dest</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mysql_query</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">sql_statement</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">finish_with_error</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="n">mysql_store_result</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">row</span> <span class="o">=</span> <span class="n">mysql_fetch_row</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Username: %s</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Name: %s %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">pCrawl</span> <span class="o">=</span> <span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>For a user with id = v this prints all the information of the friends of that user. This takes O(n) time.</p>

<h5 id="7-print-common-friends-of-two-users">7. Print Common Friends of Two Users</h5>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">find_common_friends</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="n">MYSQL</span> <span class="o">*</span><span class="n">conn</span><span class="p">,</span> <span class="n">MYSQL_ROW</span> <span class="n">row</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"here 1"</span><span class="p">);</span>
    <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">aCrawl</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">a</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">bCrawl</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">b</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"here 1"</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">aCrawl</span> <span class="o">||</span> <span class="n">bCrawl</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">aCrawl</span><span class="o">-&gt;</span><span class="n">dest</span> <span class="o">==</span> <span class="n">bCrawl</span><span class="o">-&gt;</span><span class="n">dest</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">sprintf</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">,</span> <span class="s">"SELECT username, first_name, last_name FROM</span><span class="err">
</span><span class="s">            user_database WHERE id=%d"</span><span class="p">,</span> <span class="n">aCrawl</span><span class="o">-&gt;</span><span class="n">dest</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mysql_query</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">sql_statement</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">finish_with_error</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="n">mysql_store_result</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">((</span><span class="n">row</span> <span class="o">=</span> <span class="n">mysql_fetch_row</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"Username: %s</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"Name: %s %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">aCrawl</span> <span class="o">=</span> <span class="n">aCrawl</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="n">bCrawl</span> <span class="o">=</span> <span class="n">bCrawl</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">print_common_friends</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">,</span> <span class="n">MYSQL</span> <span class="o">*</span><span class="n">conn</span><span class="p">,</span> <span class="n">MYSQL_ROW</span> <span class="n">row</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">user_a</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">user_b</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">user_a_uid</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">user_b_uid</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter the first user: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">user_a</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter the second user: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">user_b</span><span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">,</span> <span class="s">"SELECT id FROM user_database </span><span class="err">
</span><span class="s">    WHERE username='%s' OR username='%s'"</span><span class="p">,</span> <span class="n">user_a</span><span class="p">,</span> <span class="n">user_b</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mysql_query</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">sql_statement</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Query failed  with the following message:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">mysql_error</span><span class="p">(</span><span class="n">conn</span><span class="p">));</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="n">mysql_store_result</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">((</span><span class="n">row</span> <span class="o">=</span> <span class="n">mysql_fetch_row</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">strcpy</span><span class="p">(</span><span class="n">user_a_uid</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">strcpy</span><span class="p">(</span><span class="n">user_b_uid</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">user_a_uid</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">user_b_uid</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"The common friends of %s and %s are:</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">user_a</span><span class="p">,</span> <span class="n">user_b</span><span class="p">);</span>
    <span class="n">find_common_friends</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">atoi</span><span class="p">(</span><span class="n">user_a_uid</span><span class="p">),</span> <span class="n">atoi</span><span class="p">(</span><span class="n">user_b_uid</span><span class="p">),</span> <span class="n">conn</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<h5 id="8-print-friend-recommendations">8. Print Friend Recommendations</h5>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">print_friend_recommendations</span><span class="p">(</span><span class="k">struct</span> <span class="n">Graph</span> <span class="o">*</span><span class="n">graph</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">MYSQL</span> <span class="o">*</span><span class="n">conn</span><span class="p">,</span> <span class="n">MYSQL_ROW</span> <span class="n">row</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">user_node</span> <span class="o">*</span><span class="n">pCrawl</span> <span class="o">=</span> <span class="n">graph</span><span class="o">-&gt;</span><span class="n">array</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">head</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">pCrawl</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">dest</span> <span class="o">!=</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">sprintf</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">,</span> <span class="s">"SELECT username, first_name, last_name FROM user_database WHERE id=%d"</span><span class="p">,</span> <span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">dest</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mysql_query</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">sql_statement</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">finish_with_error</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="n">mysql_store_result</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
            <span class="k">while</span> <span class="p">((</span><span class="n">row</span> <span class="o">=</span> <span class="n">mysql_fetch_row</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"Recommendation from username: %s</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"Name: %s %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
                <span class="n">print_userid_friends</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">dest</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n\n</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">pCrawl</span> <span class="o">=</span> <span class="n">pCrawl</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This takes O(n*k) where k is the number of friends user with id = v has.</p>

<h5 id="9-insert-a-new-login">9. Insert a New Login</h5>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="nf">sign_up</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">conn</span><span class="p">,</span> <span class="n">MYSQL_ROW</span> <span class="n">row</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">uid</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mysql_query</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s">"SELECT id FROM user_database </span><span class="err">
</span><span class="s">    ORDER BY ID DESC LIMIT 1"</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Query failed  with the following message:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">mysql_error</span><span class="p">(</span><span class="n">conn</span><span class="p">));</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="n">mysql_store_result</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">((</span><span class="n">row</span> <span class="o">=</span> <span class="n">mysql_fetch_row</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">strcpy</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">new_uid</span> <span class="o">=</span> <span class="n">string_test</span><span class="p">(</span><span class="n">uid</span><span class="p">);</span>
    <span class="kt">char</span> <span class="n">username</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">password</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">first_name</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">last_name</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">gender</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">dob</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">phone_number</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">email</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">lives_in</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">college</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your username: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your password: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your first name: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">first_name</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your last name: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">last_name</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your gender(Male/Female): "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">gender</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your date of birth(YYYY-MM-DD): "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">dob</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your mobile number(XXX-XXX-XXXX): "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">phone_number</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your email: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">email</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your address: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">lives_in</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Enter your college: "</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">college</span><span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">sql_statement</span><span class="p">,</span> <span class="s">"INSERT INTO user_database(id, username, password, </span><span class="err">
</span><span class="s">    first_name, last_name, gender, dob, since, phone_number, </span><span class="err">
</span><span class="s">    email, lives_in, college) VALUES('%s', '%s', '%s', '%s', </span><span class="err">
</span><span class="s">    '%s', '%s', '%s', '2020-11-29', '%s','%s', '%s', '%s')"</span><span class="p">,</span> <span class="n">new_uid</span><span class="p">,</span> 
    <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> 
    <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">dob</span><span class="p">,</span> <span class="n">phone_number</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">lives_in</span><span class="p">,</span> <span class="n">college</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mysql_query</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">sql_statement</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Query failed  with the following message:</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">mysql_error</span><span class="p">(</span><span class="n">conn</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Great! you've signed up. The program shall exit now, </span><span class="err">
</span><span class="s">        next time log in with your new credentials.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>This takes constant time.</p>
:ET